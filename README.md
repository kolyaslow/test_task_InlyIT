## Тестовое задание
Этот проект представляет собой решение тестового задания от компании InlyIT
## Оглавление

1. [Используемый стек технологий](#используемый-стек-технологий)
2. [Запуск](#запуск)
4. [Документация](#Документация)
5. [Автор](#автор)

## Используемый стек технологий
- FastAPI
- SQLAlchemy
- PostgreSQL(asyncpg)
- Alembic
- Redis
- Git
- Docker

## Запуск:
Клонируйте репозиторий на локальную машину:
```commandline
$ git clone https://github.com/kolyaslow/test_task_InlyIT.git
```
Выполните команды Docker.
```docker
$ sudo docker compose up
```
После запуска, интерактивная документация доступна по адресу
(Реализовано через OpenAPI(Swagger)):

```
http://127.0.0.1:8008/docs#/
```
## Документация


<details>

<summary>Описание API</summary>

  После запуска интерактивная документация доступна по адресу (Реализовано через OpenAPI(Swagger)):
  ```
  http://127.0.0.1:8008/docs#/
  ```
ВАЖНО: API доступно лишь аторизованным, незабаненым пользователям.
При использовании API другими пользователями вызывается исключение:
ошибка недоступности API см. [общие исключения](#общие_исключения).

Дотупные АPI:
- [Регистрация пользователя](#регистрация-пользователя)
- [Вход в систему](#вход-в-систему)
- [Выход из системы](#выход-из-системы)
- [Создание объявления](#создание-объявления)
- [Просмотр объявлений](#Просмотр-объявлений)
- [Просмотр одного объявления](#Просмотр-одного-объявления)
- [Удаление объявления](#удаление-объявления)
- [Назначить администратором](#назначить-администратором)
- [Удаление комментария](#удаление-комментария)
- [Создание комментария](#создание-комментария)


### Регистрация пользователя
- Описание: Регистрирует пользователя в системе.
- Метод: POST.
- Запрос:

```
/auth/register
```

- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>user_name</td>
    <td>string</td>
    <td>Да</td>
    <td>Имя пользователя</td>
  </tr>
  <tr>
    <td>password</td>
    <td>string</td>
    <td>Да</td>
    <td>Пароль</td>
  </tr>
</table>

- Тело ответа:
```json
{
  "user_name": "string", #имя, указанное при регистрации
  "is_superuser": true, #пользователь-суперпользователь
  "is_banned": true   #показатель, забанен ли пользователь
}
```

- Ошибки:
<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>400</td>
    <td>Попытка повторной регистрации пользователя</td>
    <td>

```
{
  "detail": "REGISTER_USER_ALREADY_EXISTS"
}
```
</td>
  </tr>
</table>

### Вход в систему
- Описание: Вход в систему по имени и паролю.
- Метод: POST.
- Запрос:

```
/auth/login
```

- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>user_name</td>
    <td>string</td>
    <td>Да</td>
    <td>Имя пользователя</td>
  </tr>
  <tr>
    <td>password</td>
    <td>string</td>
    <td>Да</td>
    <td>Пароль</td>
  </tr>
</table>

- Тело ответа:
Возвращается cookies пример:
```json
  asdfsdf435fdsdf234fdsfw
```


- Ошибки:
<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>400</td>
    <td>Попытка повторной регистрации пользователя</td>
    <td>

```
{
  "detail": "REGISTER_USER_ALREADY_EXISTS"
}
```
</td>
  </tr>
</table>



### Выход из системы

- Описание: Выход из системы и удаление cookies.
- Запрос:
```
/profile/logout
```
- Параметры запроса: -
- Тело ответа:
```json
null
```

### Создание объявления

- Описание: запрос позволяет создать объявление.
- Метод: POST.
- Запрос:
```json
/announcement/create_announcement
```

- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>type</td>
    <td>string</td>
    <td>Да</td>
    <td>Тип объявления, доступны дишь:

- покупка
- продажа
</td>
  </tr>
  <tr>
    <td>description</td>
    <td>string</td>
    <td>Да</td>
    <td>Описание заказа</td>
  </tr>
  <tr>
    <td>rating</td>
    <td>int</td>
    <td>Нет</td>
    <td>рейтинг по пятибальной шкале, заполняется автоматически</td>
  </tr>
</table>

- Тело ответа:
```json
{
  "type": "продажа",
  "description": "string",
  "rating": 5,
  "id": 0, # id записи в БД
  "user_id": 0 # id пользователя, оставившего объявление
}
```


### Просмотр объявлений

- Описание: просмотр объявлений, других пользователей.
- Метод: GET.
- Запрос:
```json
/announcement/show_not_user_ads
```

- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>type</td>
    <td>string</td>
    <td>Нет</td>
    <td>
При указании типа, вернутся объявления только указанного типа, доступные значения:
- покупка
- продажа
По умолчанию None, тоесть вернуть ВСЕ объявления.
</td>
  </tr>
  <tr>
    <td>page</td>
    <td>int</td>
    <td>Нет</td>
    <td>

Указывает страницу пагинации, *значения должны быть больше 0*.
При указании недопустимого значения, выкидывается исключение:
ошибка валидации см. [общие исключения](#общие_исключения). *Значение по умолчанию 0.*
</td>
  </tr>
  <tr>
    <td>size</td>
    <td>int</td>
    <td>Нет</td>
    <td>

Количество элементов выдаваемых за раз.
*Допустимые значения от 10 до 100*.
При указании недопутимого значения, выкидывается исключение:
ошибка валидации см. [общие исключения](#общие_исключения).
*Значение по умолчанию 10.*
</td>
  </tr>
</table>

- Тело ответа:
```json
[
  {
    "type": "продажа",
    "description": "string",
    "rating": 5,
    "id": 0, #id записи объявления в БД
    "user_id": 0 #id пользователя, разметившего объявление
  }
]
```

### Просмотр одного объявления
- Описание: запрос позволяет получить определенное объявление
- Метод: GET.

- Запрос:
```
/announcement/show_one_announcement_by_id/{id_announcement}
```

- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>id_announcement</td>
    <td>int</td>
    <td>Да</td>
    <td>id объявления</td>
  </tr>
</table>

- Тело ответа:
```json
{
  "type": "продажа",
  "description": "string",
  "rating": 5,
  "id": 0, #id записи объявления в БД
  "user_id": 0 # id пользователя, оставившего объявление
}
```

- Ошибки:
<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>404</td>
    <td>Попытка получить несуществующий заказ</td>
    <td>

```
{
  "detail": "Item by id not found "
}
```
</td>
  </tr>
</table>


### Удаление объявления

- Описание: удаление объявления, при успешном удалении вернется статус код 204.
- Метод: DELETE.
- Запрос:

```json
/admin/delete_comment/{id_comment}
```
- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>id_comment</td>
    <td>int</td>
    <td>Да</td>
    <td>id объявления</td>
  </tr>
</table>

- Тело ответа:

```json
none
```


### Назначить администратором

- Описание: назначить пользователя админитратором, при успешном назначении вернется статус код 200.
API доступно только администраторам,
При использовании API другими пользователями вызывается исключение:
ошибка недоступности API см. [общие исключения](#общие_исключения).
- Метод: PATCH.
- Запрос:
```
/admin/set_user_an_admin/{user_name_new_admin}
```
- Параметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>user_name_new_admin</td>
    <td>int</td>
    <td>ДА</td>
    <td> Имя пользователя, которого назначают в админитстраторы
</td>
  </tr>
</table>

- Тело ответа:
```json
none
```

- Ошибки:
<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>404</td>
    <td>Попытка повторной регистрации пользователя</td>
    <td>

```
{
  "detail": "User not found"
}
```
</td>
  </tr>
</table>

### Удаление комментария

- Описание: удаление любого комментария, при успешном удалении, вернется статус код 204.
- Метод: DELETE.
- Запрос:
```
/admin/delete_comment/{id_comment}
```
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>id_comment</td>
    <td>int</td>
    <td>ДА</td>
    <td> id комментария, который нужно удалить</td>
  </tr>
</table>

- Тело ответа:
```json
none
```

- Ошибки:
<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>404</td>
    <td>Попытка повторной регистрации пользователя</td>
    <td>

```
{
  "detail": "Item by id not found"
}
```
</td>
  </tr>
</table>


### Создание комментария
- Описание: создание коментария к заказу, коммментарий может быть ввиде отзыва ошибки или просто комментарий
- Метод: POST.
- Запрос:
```
/comment/create_comment/{announcement_id}
```
- Парметры запроса:
<table>
  <tr>
    <th>Поле</th>
    <th>Тип</th>
    <th>Обязательный параметр</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td>type</td>
    <td>str</td>
    <td>Нет</td>
    <td> Тип комментария, соответствующий следующим значения:

- отзыв
- жалоба
- комментарий

По умолчания значение type=коментарий, если при указании type=отзыв,
то в зависимотси от параметра score, будет пересчитано поле rating у объявления.

</td>
  </tr>

<tr>
    <td>id_announcement</td>
    <td>int</td>
    <td>Да</td>
    <td>id объявления, для которого оставляется комментарий</td>
  </tr>
<tr>
    <td>text</td>
    <td>str</td>
    <td>Да</td>
    <td>Текст объявления</td>
  </tr>
<tr>
    <td>score</td>
    <td>int</td>
    <td>Нет</td>
    <td>

Оценка объявления, по пятибальной шкале от 1 до 5.
При указании недопутимого значения, выкидывается исключение:
ошибка валидации см. [общие исключения](#общие_исключения). *Значение по умолчанию 5.*

</td>
  </tr>
</table>

- Тело ответа:
```json
none
```

- Ошибки:
<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>404</td>
    <td>Попытка написать комментарий, несуществующему объявлению</td>
    <td>

```
{
  "detail": "Item by id not found"
}
```
</td>
  </tr>
</table>
</details>

<details>

  <summary id="общие_исключения">Общие исключения</summary>

<table>
  <tr>
    <th>Статус код</th>
    <th>Описание</th>
    <th>Возвращаемый ответ</th>
  </tr>
  <tr>
    <td>422</td>
    <td>Ошибка валидации входных данных</td>
    <td>

```json
{
  "detail": [
    {
      "loc": [
        "string",
        0
      ],
      "msg": "string",
      "type": "string"
    }
  ]
}
```
</td>
  </tr>


  <tr>
    <td>403</td>
    <td>Возникает при попытки получить доступ к недоступным API</td>
    <td>

```json
{
  "detail": "Unauthorized"
}
```
</td>
  </tr>
</table>
</details>



## Автор
**Николай Пышенко**
- email: pysenkon@gmail.com
- Telegram: [@koliaslow](https://t.me/koliaslow)
- VK: [@koliaslow](https://vk.com/koliaslow)
